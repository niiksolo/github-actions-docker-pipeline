name: CD

on:
  workflow_run:
    workflows: ["CI"]
    types:
      - completed

jobs:
  deploy-staging:
    runs-on: ubuntu-latest
    needs: []
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: Deploy to Staging (manual)
        run: echo "üöÄ Deploying staging with Docker pull..."
        shell: bash
    environment:
      name: staging
    concurrency: staging
    # —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫
    workflow_dispatch:

  deploy-prod:
    runs-on: ubuntu-latest
    needs: []
    if: ${{ github.event.workflow_run.conclusion == 'success' && github.ref == 'refs/heads/main' }}
    steps:
      - name: Deploy to Production
        run: echo "üöÄ Deploying production with Docker pull..."
        shell: bash
    environment:
      name: production
    concurrency: production