name: CD

on:
  workflow_run:
    workflows: ["CI"]
    types:
      - completed
  workflow_dispatch:   # ðŸ‘ˆ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾

jobs:
  deploy-staging:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' || github.event_name == 'workflow_dispatch' }}
    steps:
      - name: Deploy to Staging
        run: echo "ðŸš€ Deploying staging with Docker pull..."
    environment:
      name: staging
    concurrency: staging

  deploy-prod:
    runs-on: ubuntu-latest
    if: ${{ (github.event.workflow_run.conclusion == 'success' && github.ref == 'refs/heads/main') || github.event_name == 'workflow_dispatch' }}
    steps:
      - name: Deploy to Production
        run: echo "ðŸš€ Deploying production with Docker pull..."
    environment:
      name: production
    concurrency: production